---
title: "Affordable Learning and Financial Support"
editor: visual
---

This is a chapter about affordable learning and financial support at University of California San Diego

```{r}
#| label: run_scripts
#| include: FALSE

source("rscripts/load_packages.R", local = knitr::knit_global())

source("rscripts/functions_clean_data.R" ,local = knitr::knit_global())

source("rscripts/functions_visualize.R" ,local = knitr::knit_global())

```

```{r}
#| label: load_data
#| include: FALSE

#ucues
es<- read_excel("data/ucues_2022_rebuild.xlsx")%>%
  filter(wg=="Affordable")%>%
  label_groups(.)

ucall<-read_excel("data/ucues_alluc.xlsx")

gses<-read_excel("data/UCGSES.xlsx")%>%
  filter(wg=="Affordable")%>%
  label_groups(.)

ucall_gses<-read_excel("data/gses_alluc.xlsx")

```

```{r}
#| label: viz_captions
#| include: FALSE

#Diff labels
lab_diff_axis_ug<-"Difference from all undergraduate average"
lab_diff_axis_grad<-"Difference from all graduate student average"

#caption
caption_ug<-"Source: UCUES 2022, UC Infocenter"
caption_grad<-"Source: GSES 2021 UC Infocenter"
```

## Undergraduates

All data come from UCUES

### Food Security

Student respondents are assigned a food security level: very low food security, low food security, or food secure, based on their responses to six questions. 

For more information on this measure, please visit [UCOP Measuring Food Insecurity](https://www.universityofcalifornia.edu/sites/default/files/measuring-food-insecurity.pdf)


#### Food Security over Time

These visuals display the percentage respondents who are "food secure. For example, in 2022 58% of UCSD undergraduate respondents were classified as food secure. This means the remaining 42% of respondents were food insecure- either low food security or very low food security. 


The percent of undergraduates who are food secure has remained relatively stable over time -between roughly 50-60%. UCSD's food security rates are slightly higher or equal to the overal UC system rate. 

```{r}
#| label: food_secure_ug_overtime
#| echo: FALSE
#| warning: FALSE

foodsecure_uccomp<-ucall%>%
  filter(q=="Food Security"&campus=="UC")%>%
  clean_vibe_foodsecure(.)%>%
  group_by(year, vibe)%>%
  summarize(value=sum(value),
            N=sum(N))%>%
  filter(vibe=="positive")%>%
  ungroup(.)%>%
  mutate(campus="All UC")

food_secure_time<-es%>%
  #select question and comparison group - leave all years
  filter(q=="Food Security"&comp=="All")%>%
  clean_vibe_foodsecure(.)%>%
  group_by(year, vibe)%>%
  summarize(value=sum(value),
            N=sum(N))%>%
  filter(vibe=="positive")%>%
  ungroup(.)%>%
  mutate(campus="UCSD")%>%
  bind_rows(., foodsecure_uccomp)

  
  g_foodsecure_time<-plot_time(food_secure_time)+
  #need to tweak scale because otherwise it's too zoomed in
  scale_y_continuous(labels=scales::percent_format(accuracy=1),limits=c(.5,.75))+
   labs(title="Food Secure",
        caption=caption_ug,
      subtitle = 'Percent of Food Secure respondents',
         x="UCUES Survey Year")

direct.label(g_foodsecure_time,list(cex=30,  "first.qp"))

```


#### Food Security Differences by Group

Focusing on UCSD students in 2022, we find that there are significant differences by student group. Students who are not First Generation (64%), not Pell Grant Recipients (64%), or are White (63%) or Asian (61%) as defined by UCOP have higher rates of food security than the student body average of 58%. Food security among international students is the same as the student body average. 

Conversely, the food security rates of American Indian students (50%), First Generation students (49%) Pell Grant recipients (48%), Hispanic or Latinx students (48%) or African American students(44%), are less than the student body average. For all these groups, at least half of students are food insecure. The span of the difference is 20 percentage points- between students who don't recieve Pell Grants (64%) and African American students (44%).

```{r}
#| label: food_secure_ug_differences_2022
#| echo: FALSE
#| warning: FALSE
foodsecure_all_2022<-es%>%
filter(q=="Food Security"&year=="2022"&comp=="All")%>%
  clean_vibe_foodsecure(.)%>%
collapse_positive_vibe(.)

foodsecure_2022<-es%>%
  filter(q=="Food Security"&year=="2022")%>%
  clean_vibe_foodsecure(.)%>%
  order_comp_group_all(.)%>%
collapse_positive_vibe(.)%>%
  mutate(all=foodsecure_all_2022$value)%>%
  create_diff_cols(.)

  
plot_lollipop_div(foodsecure_2022)+
  #first axis- divergence
  scale_y_continuous(labels=scales::percent_format(accuracy=1),limits=c(-.15,.1),
  #second axis- real value
  sec.axis = sec_axis(~ . +foodsecure_all_2022$value, labels=scales::label_percent(accuracy=1)))+
  #labels
   labs(title="Food secure",
       subtitle ="UCSD Undergrads who are food secure",
       y=lab_diff_axis_ug,
       caption=caption_ug)
```