---
title: "Academic Outcomes"
editor: visual
---

This is a chapter about academic outcomes at UCSD

```{r}
#| label: run_scripts
#| include: FALSE

source("rscripts/load_packages.R", local = knitr::knit_global())

source("rscripts/functions_clean_data.R" ,local = knitr::knit_global())

source("rscripts/functions_visualize.R" ,local = knitr::knit_global())

```

```{r}
#data is from the UCSD IR -datatable with https://tableau.ucsd.edu/#/views/UGGraduationandRetentionRates2022/TransferGraduationRates?:iid=1

cumu_ftfy<-read_excel("data/cumu_grad_rates.xlsx", sheet="FTFY", na=c("0.000",""))%>%
  label_groups(.)%>%
  mutate(across(perc_6:perc_8, ~na_if(.x,0)))


cumu_t<-read_excel("data/cumu_grad_rates.xlsx", sheet="Transfer",na=c("0.000",""))%>%
  label_groups(.)%>%
mutate(across(perc_2:perc_5, ~na_if(.x,0)))

ret<-read_excel("data/grad_outcomes_ucsd.xlsx", sheet="retention")%>%
  label_groups(.)
    
```

Cumulative Graduation Rates

## Undergraduate

### Graduation Rates

Defined as six years or less for FTFY, defined or four years or less for transfer students.

```{r}

ftfy_six_2016<-cumu_ftfy%>%
filter(entrycohort=="2016")%>%
  #select the graduate period of interest and make it match the formula's generic column name  - value 
  mutate(value=perc_6)%>%
  select(comp, group, group_label, value)%>%
  mutate(all=filter(., comp=="All")%$% value)%>%
  order_comp_group_all(.)%>%
  create_diff_cols(.)%>%
  #flip factor levels to make a better visual - graduate rates are positive
  mutate(avg_above=fct_rev(avg_above))

plot_text_div(ftfy_six_2016)%>%
  plot_diff(.,ftfy_six_2016,.72,.96)+
  labs(title="FTFY Six Years or Less Graduation Rate",
       subtitle ="UCSD FTFY 2016 Entry Cohort",
       caption="Data Source: UCSD IR")
 
 ggsave("viz/academic/ftfy_six_2016.png", width=9, height=5, units="in", dpi=300)
      
  
  
```

```{r}
t_four_2018<-cumu_t%>%
filter(entrycohort=="2018")%>%
  #select the graduate period of interest and make it match the formula's generic column name  - value 
  mutate(value=perc_4)%>%
  select(comp, group, group_label, value)%>%
  mutate(all=filter(., comp=="All")%$% value)%>%
  order_comp_group_all(.)%>%
  create_diff_cols(.)



plot_text_div(t_four_2018)%>%
plot_diff(.,t_four_2018,.8,.97)+
   labs(title="Transfer Students Four Years or Less Graduation Rate",
       subtitle ="UCSD Transfer 2018 Entry Cohort",
       caption="Data Source: UCSD IR")
 
 ggsave("viz/academic/t_four_2018.png", width=9, height=5, units="in", dpi=300)
      
  
 

```

```{r}
ftfy_four_2018<-cumu_ftfy%>%
filter(entrycohort=="2018")%>%
  #select the graduate period of interest and make it match the formula's generic column name  - value 
  mutate(value=perc_4)%>%
  select(comp, group, group_label, value)%>%
  mutate(all=filter(., comp=="All")%$% value)%>%
  order_comp_group_all(.)%>%
  create_diff_cols(.)%>%
  #flip factor levels to make a better visual - graduate rates are positive
  mutate(avg_above=fct_rev(avg_above))

plot_text_div(ftfy_four_2018)%>%
  plot_diff(., ftfy_four_2018,.53,.84)+
labs(title="FTFY Four Years or Less Graduation Rate",
       subtitle ="UCSD FTFY 2018 Entry Cohort",
       caption="Data Source: UCSD IR")

 ggsave("viz/academic/ftfy_four_2018.png", width=9, height=5, units="in", dpi=300)
```

```{r}

t_two_2020<-cumu_t%>%
filter(entrycohort=="2020")%>%
  #select the graduate period of interest and make it match the formula's generic column name  - value 
  mutate(value=perc_2)%>%
  select(comp, group, group_label, value)%>%
  mutate(all=filter(., comp=="All")%$% value)%>%
  order_comp_group_all(.)%>%
  create_diff_cols(.)%>%
  filter(group!="American Indian")



plot_text_div(t_two_2020)%>%
  plot_diff(., t_two_2020, .43,.68)+
  labs(title="Transfer Students Two Years or Less Graduation Rate",
       subtitle ="UCSD Transfer 2020 Entry Cohort",
       caption="Data Source: UCSD IR")
  ggsave("viz/academic/t_two_2020.png", width=9, height=5, units="in", dpi=300)
```
### One Year Retention

```{r}
ftfy_ret_2021<-ret%>%
filter(entrycohort=="2021"& transfer=="N")%>%
  mutate(all=filter(., comp=="All")%$% value)%>%
  order_comp_group_all(.)%>%
  create_diff_cols(.)

plot_text_div(ftfy_ret_2021)%>%
plot_diff(.,ftfy_ret_2021,.83,1)+
  labs(title="FTFY One Year Retention Rate",
       subtitle ="UCSD FTFY 2021 Entry Cohort",
       caption="Data Source: UCSD IR")
  ggsave("viz/academic/ftfy_ret_2021.png", width=9, height=5, units="in", dpi=300)
```


